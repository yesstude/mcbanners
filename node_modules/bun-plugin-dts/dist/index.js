import{createRequire as X}from"node:module";var K=Object.create;var{getPrototypeOf:M,defineProperty:z,getOwnPropertyNames:N}=Object;var O=Object.prototype.hasOwnProperty;var Q=(A,E,c)=>{c=A!=null?K(M(A)):{};const j=E||!A||!A.__esModule?z(c,"default",{value:A,enumerable:!0}):c;for(let R of N(A))if(!O.call(j,R))z(j,R,{get:()=>A[R],enumerable:!0});return j};var V=(A,E)=>()=>(E||A((E={exports:{}}).exports,E),E.exports);var Y=X(import.meta.url);var G=V((a,C)=>{var{sep:Z}=Y("path"),$=(A)=>{for(let E of A){const c=/(\/|\\)/.exec(E);if(c!==null)return c[0]}return Z};C.exports=function A(E,c=$(E)){const[j="",...R]=E;if(j===""||R.length===0)return"";const T=j.split(c);let q=T.length;for(let W of R){const L=W.split(c);for(let S=0;S<q;S++)if(L[S]!==T[S])q=S;if(q===0)return""}const U=T.slice(0,q).join(c);return U.endsWith(c)?U:U+c}});var H=Q(G(),1);import _ from"node:fs";import k from"node:path";import{generateDtsBundle as f}from"dts-bundle-generator";import{getTsconfig as B}from"get-tsconfig";var P=(A)=>{return{name:"bun-plugin-dts",async setup(E){const{compilationOptions:c,...j}=A||{},R=[...E.config.entrypoints].sort(),T=R.map((S)=>{return{filePath:S,...j}}),q=c?.preferredConfigPath??B()?.path,U=f(T,{...c,preferredConfigPath:q}),W=E.config.outdir||"./dist";if(!_.existsSync(W))_.mkdirSync(W,{recursive:!0});let L=H.default(R);if(!L||L===process.cwd())L=k.dirname(R[0]);await Promise.all(R.map((S,I)=>{const J=k.relative(L,S).replace(/\.[jtm]s$/,".d.ts"),v=k.join(W,J),w=k.dirname(v);if(!_.existsSync(w))_.mkdirSync(w,{recursive:!0});return Bun.write(v,U[I])}))}}},u=P;export{u as default};
